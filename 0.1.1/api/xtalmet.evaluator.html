

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>xtalmet.evaluator module &mdash; xtalmet 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=0745d1ac" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/github_style.css?v=1093691d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="xtalmet.screen module" href="xtalmet.screen.html" />
    <link rel="prev" title="xtalmet.distance module" href="xtalmet.distance.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            xtalmet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="xtalmet.html">API</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="xtalmet.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="xtalmet.crystal.html">xtalmet.crystal module</a></li>
<li class="toctree-l3"><a class="reference internal" href="xtalmet.distance.html">xtalmet.distance module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">xtalmet.evaluator module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#xtalmet.evaluator.Evaluator"><code class="docutils literal notranslate"><span class="pre">Evaluator</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="xtalmet.screen.html">xtalmet.screen module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">xtalmet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="xtalmet.html">xtalmet package</a></li>
      <li class="breadcrumb-item active">xtalmet.evaluator module</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-xtalmet.evaluator">
<span id="xtalmet-evaluator-module"></span><h1>xtalmet.evaluator module<a class="headerlink" href="#module-xtalmet.evaluator" title="Link to this heading"></a></h1>
<p>This module contains the Evaluator class for uniqueness and novelty calculation.</p>
<dl class="py class">
<dt class="sig sig-object py" id="xtalmet.evaluator.Evaluator">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">xtalmet.evaluator.</span></span><span class="sig-name descname"><span class="pre">Evaluator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gen_xtals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><span class="pre">Crystal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Structure</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xtalmet.evaluator.Evaluator" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class for storing and evaluating a set of crystals.</p>
<p>Initialize the Evaluator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>gen_xtals</strong> (<em>list</em><em>[</em><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><em>Crystal</em></a><em> | </em><em>Structure</em><em>]</em>) – Generated crystal structures.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="xtalmet.evaluator.Evaluator.uniqueness">
<span class="sig-name descname"><span class="pre">uniqueness</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stability</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_intermediate_gen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiprocessing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_processes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#xtalmet.evaluator.Evaluator.uniqueness" title="Link to this definition"></a></dt>
<dd><p>Evaluate the uniqueness of a set of crystals.</p>
<p>You can optionally combine validity screening and stability evaluation. This
means that you can evaluate VU, SU, and VSU as well.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>distance</strong> (<em>str</em>) – Distance function used for uniqueness evaluation. Currently
supported distances are shown in SUPPORTED_DISTANCES in constants.py.
For more detailed information about each distance metric, please refer
to the <a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>.</p></li>
<li><p><strong>normalize</strong> (<em>bool</em>) – Whether to normalize the distance d to [0, 1] by using d’
= d / (1 + d). This argument is only considered when d is a continuous
distance that is not normalized to [0, 1]. Such distances are listed in
CONTINUOUS_UNNORMALIZED_DISTANCES in constants.py. To fit the final
uniqueness score in [0, 1], we recommend setting this argument to True.
Default is True.</p></li>
<li><p><strong>validity</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>) – Methods to screen the crystals. Currently
supported methods are shown in SUPPORTED_VALIDITY in constants.py.</p></li>
<li><p><strong>stability</strong> (<em>str</em><em> | </em><em>None</em>) – Stability criterion for the crystals. “continuous”
or “binary” or None.</p></li>
<li><p><strong>dir_intermediate_gen</strong> (<em>str</em><em> | </em><em>None</em>) – Directory to search for pre-computed
embeddings, distance matrix, and screening results for faster
computation. If pre-computed files do not exist in the directory, they
will be saved to the directory for future use. If set to None, no files
will be loaded or saved. It is recommended that you set this argument.
This is especially important when evaluating a large number of generated
crystals or when d_smat is used as the distance metric.</p></li>
<li><p><strong>multiprocessing</strong> (<em>bool</em>) – Whether to use multiprocessing for distance matrix
calculation. Default is False.</p></li>
<li><p><strong>n_processes</strong> (<em>int</em><em> | </em><em>None</em>) – Maximum number of processes to use for
multiprocessing. If None, the number of logical CPU cores - 1 will be
used. We recommend setting this argument to a smaller number than the
number of available CPU cores to avoid memory issues. If multiprocessing
is False, this argument is ignored. Default is None.</p></li>
<li><p><strong>return_time</strong> (<em>bool</em>) – Whether to return the time taken for each step.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments for specific distance metrics and
stability calculations. It can contain four keys: “args_emb”,
“args_dist”, “args_validity”, and “args_stability”. “args_emb” is for
the calculation of embeddings, “args_dist” is for the calculation of
distance matrix using the embeddings, “args_validity” is for the
validity screening, and “args_stability” is for the stability
evaluation. For more details, please refer to the <a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">uniqueness</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;smat&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span>
<span class="gp">... </span>    <span class="mf">0.8841</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;uni_emb&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;uni_d_mtx&quot;</span><span class="p">:</span> <span class="mf">803.5594861507416</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;uni_metric&quot;</span><span class="p">:</span> <span class="mf">0.13433599472045898</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;uni_total&quot;</span><span class="p">:</span> <span class="mf">803.693822145462</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">uniqueness</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;pdd&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span> <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.00949325955406104</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">uniqueness</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;amd&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_emb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_dist&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;chebyshev&quot;</span><span class="p">,</span> <span class="s2">&quot;low_memory&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_validity&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_distance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_volume&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="gp">... </span>            <span class="p">}</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span> <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">1.215</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.10731830578122291</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Uniqueness value or a tuple containing the uniqueness value
and a dictionary of time taken for each step.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float | tuple</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If an unsupported distance metric or validity method or
    stability criterion is provided.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here, I demonstrate how uniqueness is computed for binary/continuous
distances with binary/continuous stability. The binary stability score,
<span class="math notranslate nohighlight">\(S_b(x)\)</span>, for each crystal <span class="math notranslate nohighlight">\(x\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_b(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le \text{threshold} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>You can set the threshold in kwargs (see the examples). Default threshold is
0.1 [eV/atom]. The continuous stability score, <span class="math notranslate nohighlight">\(S_c(x)\)</span>, for each
crystal <span class="math notranslate nohighlight">\(x\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_c(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le 0 \\
                1 - \frac{E_\text{hull}(x)}{\text{intercept}} &amp; \text{if }
                E_\text{hull}(x) \le \text{intercept} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>You can set the intercept in kwargs. Default intercept is 1.215 [eV/atom].
Then, the uniqueness score with a binary distance, optional validity
screening and stability evaluation is calculated as follows.</p>
<div class="math notranslate nohighlight">
\[U = \frac{1}{n} \sum_{i=1}^{n} V(x_i) \cdot S(x_i) \cdot I \left(
\land_{j=1}^{i-1} \left( V(x_j) = 0 \lor S(x_j) = 0 \lor d(x_i, x_j)
\neq 0 \right) \right),\]</div>
<p>where <span class="math notranslate nohighlight">\(\{x_1, x_2, \ldots, x_n\}\)</span> is the set of generated crystals,
<span class="math notranslate nohighlight">\(I\)</span> is the indicator function, <span class="math notranslate nohighlight">\(S\)</span> is either <span class="math notranslate nohighlight">\(S_b\)</span> or
<span class="math notranslate nohighlight">\(S_c\)</span>, and <span class="math notranslate nohighlight">\(V\)</span> is the validity function that returns 1 for valid
crystals and 0 for invalid crystals. For a continuous distance, the
uniqueness score is calculated as follows.</p>
<div class="math notranslate nohighlight">
\[U = \frac{1}{n} \sum_{i=1}^{n} V(x_i) \cdot S(x_i) \cdot \left(
\frac{1}{n-1} \sum_{j=1}^{n} V(x_j) \cdot S(x_j) \cdot d(x_i, x_j)
\right).\]</div>
<p>If normalize is True, each distance <span class="math notranslate nohighlight">\(d(x_i, x_j)\)</span> is normalized to
<span class="math notranslate nohighlight">\(d'(x_i, x_j) = \frac{d(x_i, x_j)}{1 + d(x_i, x_j)}.\)</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="xtalmet.evaluator.Evaluator.novelty">
<span class="sig-name descname"><span class="pre">novelty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_xtals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><span class="pre">Crystal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Structure</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'mp20'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stability</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_intermediate_gen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_intermediate_train</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiprocessing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_processes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#xtalmet.evaluator.Evaluator.novelty" title="Link to this definition"></a></dt>
<dd><p>Evaluate the novelty of a set of crystals.</p>
<p>You can optionally combine validity screening and stability evaluation. This
means that you can evaluate VN, SN, and VSN as well.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_xtals</strong> (<em>list</em><em>[</em><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><em>Crystal</em></a><em> | </em><em>Structure</em><em>] </em><em>| </em><em>Literal</em><em>[</em><em>&quot;mp20&quot;</em><em>]</em>) – List of training
crystal structures or dataset name. If a dataset name is given, the
embeddings of its training data will be downloaded from Hugging Face.
The embeddings were computed using the _compute_embeddings function in
distance.py with no additional kwargs.</p></li>
<li><p><strong>distance</strong> (<em>str</em>) – Distance used for novelty evaluation. Currently supported
distances are shown in SUPPORTED_DISTANCES in constants.py. For more
detailed information about each distance metric, please refer to the
<a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>.</p></li>
<li><p><strong>normalize</strong> (<em>bool</em>) – Whether to normalize the distance d to [0, 1] by using d’
= d / (1 + d). This argument is only considered when d is a continuous
distance that is not normalized to [0, 1]. Such distances are listed in
CONTINUOUS_UNNORMALIZED_DISTANCES in constants.py. To fit the final
uniqueness score in [0, 1], we recommend setting this argument to True.
Default is True.</p></li>
<li><p><strong>validity</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>) – Method to screen the crystals. Currently
supported methods are shown in SUPPORTED_VALIDITY in constants.py.</p></li>
<li><p><strong>stability</strong> (<em>str</em><em> | </em><em>None</em>) – Stability criterion for the crystals. “continuous”
or “binary” or None.</p></li>
<li><p><strong>dir_intermediate_gen</strong> (<em>str</em><em> | </em><em>None</em>) – Directory to search for pre-computed
embeddings, distance matrix, and screening results for faster
computation. If pre-computed files do not exist in the directory, they
will be saved to the directory for future use. If set to None, no files
will be loaded or saved. It is recommended that you set this argument.
This is especially important when evaluating a large number of generated
crystals or when d_smat is used as the distance metric.</p></li>
<li><p><strong>dir_intermediate_train</strong> (<em>str</em><em> | </em><em>None</em>) – Directory to search for pre-computed
embeddings of training crystals. If pre-computed files do not exist in
the directory, they will be saved to the directory for future use. If
set to None, no files will be loaded or saved. It is recommended that
you set this argument. This is especially important when evaluating a
large number of generated crystals. If train_xtals is a dataset name,
this argument is ignored.</p></li>
<li><p><strong>multiprocessing</strong> (<em>bool</em>) – Whether to use multiprocessing for distance matrix
calculation. Default is False.</p></li>
<li><p><strong>n_processes</strong> (<em>int</em><em> | </em><em>None</em>) – Maximum number of processes to use for
multiprocessing. If None, the number of logical CPU cores - 1 will be
used. We recommend setting this argument to a smaller number than the
number of available CPU cores to avoid memory issues. If multiprocessing
is False, this argument is ignored. Default is None.</p></li>
<li><p><strong>return_time</strong> (<em>bool</em>) – Whether to return the time taken for each step.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments for specific distance metrics and
stability calculations. It can contain four keys: “args_emb”,
“args_dist”, “args_validity”, and “args_stability”. “args_emb” is for
the calculation of embeddings, “args_dist” is for the calculation of
distance matrix using the embeddings, “args_validity” is for the
validity screening, and “args_stability” is for the stability
evaluation. For more details, please refer to the <a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">novelty</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">train_xtals</span><span class="o">=</span><span class="s2">&quot;mp20&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;smat&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span>
<span class="gp">... </span>    <span class="mf">0.4582</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_emb_gen&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_emb_train&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_d_mtx&quot;</span><span class="p">:</span> <span class="mf">4101.729508161545</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_metric&quot;</span><span class="p">:</span> <span class="mf">0.19302725791931152</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_total&quot;</span><span class="p">:</span> <span class="mf">4101.922535419464</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">novelty</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">train_xtals</span><span class="o">=</span><span class="n">list_of_train_xtals</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;pdd&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_train</span><span class="o">=</span><span class="s2">&quot;./intermediate_train&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.018415067583298726</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">novelty</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">train_xtals</span><span class="o">=</span><span class="n">list_of_train_xtals</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;amd&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_train</span><span class="o">=</span><span class="s2">&quot;./intermediate_train&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_emb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_dist&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;chebyshev&quot;</span><span class="p">,</span> <span class="s2">&quot;low_memory&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_validity&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_distance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_volume&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="gp">... </span>            <span class="p">}</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span> <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">1.215</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.05000752831894141</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Novelty value or a tuple containing the novelty value
and a dictionary of time taken for each step.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float | tuple</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If an unsupported dataset name, distance metric, or screening
    method is provided.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here, I demonstrate how novelty is computed for binary/continuous distances
with binary/continuous stability. The binary stability score, <span class="math notranslate nohighlight">\(S_b(x)\)</span>
, for each crystal <span class="math notranslate nohighlight">\(x\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_b(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le \text{threshold} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>You can set the threshold in kwargs (see the examples). Default threshold is
0.1 [eV/atom]. The continuous stability score, <span class="math notranslate nohighlight">\(S_c(x)\)</span>, for each
crystal <span class="math notranslate nohighlight">\(x\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_c(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le 0 \\
                1 - \frac{E_\text{hull}(x)}{\text{intercept}} &amp; \text{if }
                E_\text{hull}(x) \le \text{intercept} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>You can set the intercept in kwargs. Default intercept is 1.215 [eV/atom].
Then, the novelty score with a binary distance, optional validity screening,
and stability evaluation is calculated as follows.</p>
<div class="math notranslate nohighlight">
\[N = \frac{1}{n} \sum_{i=1}^{n} V(x_i) \cdot S(x_i) \cdot I \left(
\land_{j=1}^{m} d(x_i, y_j) \neq 0 \right),\]</div>
<p>where <span class="math notranslate nohighlight">\(\{x_1, x_2, \ldots, x_n\}\)</span> is the set of generated crystals,
<span class="math notranslate nohighlight">\(\{y_1, y_2, \ldots, y_m\}\)</span> is the set of training crystals, <span class="math notranslate nohighlight">\(I\)</span>
is the indicator function, <span class="math notranslate nohighlight">\(S\)</span> is either <span class="math notranslate nohighlight">\(S_b\)</span> or <span class="math notranslate nohighlight">\(S_c\)</span>,
and <span class="math notranslate nohighlight">\(V\)</span> is the validity function that returns 1 for valid crystals and
0 for invalid crystals. For a continuous distance, the novelty score is
calculated as follows.</p>
<div class="math notranslate nohighlight">
\[N = \frac{1}{n} \sum_{i=1}^{n} V(x_i) \cdot S(x_i) \cdot
\min_{j=1 \ldots m} d(x_i, y_j).\]</div>
<p>If normalize is True, each distance <span class="math notranslate nohighlight">\(d(x_i, x_j)\)</span> is normalized to
<span class="math notranslate nohighlight">\(d'(x_i, x_j) = \frac{d(x_i, x_j)}{1 + d(x_i, x_j)}.\)</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="xtalmet.evaluator.Evaluator.vsun">
<span class="sig-name descname"><span class="pre">vsun</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_xtals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><span class="pre">Crystal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Structure</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'mp20'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stability</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_intermediate_gen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_intermediate_train</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiprocessing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_processes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#xtalmet.evaluator.Evaluator.vsun" title="Link to this definition"></a></dt>
<dd><p>Evaluate the VSUN of a set of crystals.</p>
<p>VSUN stands for Validity, Stability, Uniqueness, and Novelty. V and S are
optional, so you can also evaluate UN, SUN, or VUN.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_xtals</strong> (<em>list</em><em>[</em><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><em>Crystal</em></a><em> | </em><em>Structure</em><em>] </em><em>| </em><em>Literal</em><em>[</em><em>&quot;mp20&quot;</em><em>]</em>) – List of training
crystal structures or dataset name. If a dataset name is given, the
embeddings of its training data will be downloaded from Hugging Face.
The embeddings were computed using the _compute_embeddings function in
distance.py with no additional kwargs.</p></li>
<li><p><strong>distance</strong> (<em>str</em>) – Distance used for uniqueness and novelty evaluation.
Currently supported distances are shown in SUPPORTED_DISTANCES in
constants.py. For more detailed information about each distance metric,
please refer to the <a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>.</p></li>
<li><p><strong>validity</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>) – Method to screen the crystals. Currently
supported methods are shown in SUPPORTED_VALIDITY in constants.py.</p></li>
<li><p><strong>stability</strong> (<em>str</em><em> | </em><em>None</em>) – Stability criterion for the crystals. “continuous”
or “binary” or None.</p></li>
<li><p><strong>dir_intermediate_gen</strong> (<em>str</em><em> | </em><em>None</em>) – Directory to search for pre-computed
embeddings, distance matrix, and screening results for faster
computation. If pre-computed files do not exist in the directory, they
will be saved to the directory for future use. If set to None, no files
will be loaded or saved. It is recommended that you set this argument.
This is especially important when evaluating a large number of generated
crystals or when d_smat is used as the distance metric.</p></li>
<li><p><strong>dir_intermediate_train</strong> (<em>str</em><em> | </em><em>None</em>) – Directory to search for pre-computed
embeddings of training crystals. If pre-computed files do not exist in
the directory, they will be saved to the directory for future use. If
set to None, no files will be loaded or saved. It is recommended that
you set this argument. This is especially important when evaluating a
large number of generated crystals. If train_xtals is a dataset name,
this argument is ignored.</p></li>
<li><p><strong>multiprocessing</strong> (<em>bool</em>) – Whether to use multiprocessing for distance matrix
calculation. Default is False.</p></li>
<li><p><strong>n_processes</strong> (<em>int</em><em> | </em><em>None</em>) – Maximum number of processes to use for
multiprocessing. If None, the number of logical CPU cores - 1 will be
used. We recommend setting this argument to a smaller number than the
number of available CPU cores to avoid memory issues. If multiprocessing
is False, this argument is ignored. Default is None.</p></li>
<li><p><strong>return_time</strong> (<em>bool</em>) – Whether to return the time taken for each step.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments for specific distance metrics and
stability calculations. It can contain four keys: “args_emb”,
“args_dist”, “args_validity”, and “args_stability”. “args_emb” is for
the calculation of embeddings, “args_dist” is for the calculation of
distance matrix using the embeddings, “args_validity” is for the
validity screening, and “args_stability” is for the stability
evaluation. For more details, please refer to the <a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">vsun</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">train_xtals</span><span class="o">=</span><span class="s2">&quot;mp20&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;smat&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span>
<span class="gp">... </span>    <span class="mf">0.4456</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>                    <span class="s2">&quot;uni_emb&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;uni_d_mtx&quot;</span><span class="p">:</span> <span class="mf">976.966584444046</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_emb_gen&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_emb_train&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;nov_d_mtx&quot;</span><span class="p">:</span> <span class="mf">4859.646441698074</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;vsun_metric&quot;</span><span class="p">:</span> <span class="mf">0.36957240104675293</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;vsun_total&quot;</span><span class="p">:</span> <span class="mf">5836.982598543167</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">vsun</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">train_xtals</span><span class="o">=</span><span class="n">list_of_train_xtals</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;pdd&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_train</span><span class="o">=</span><span class="s2">&quot;./intermediate_train&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.0013761904710659482</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">vsun</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">train_xtals</span><span class="o">=</span><span class="n">list_of_train_xtals</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;amd&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_gen</span><span class="o">=</span><span class="s2">&quot;./intermediate&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dir_intermediate_train</span><span class="o">=</span><span class="s2">&quot;./intermediate_train&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">return_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="o">**</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_emb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_dist&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;chebyshev&quot;</span><span class="p">,</span> <span class="s2">&quot;low_memory&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_validity&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_distance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_volume&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="gp">... </span>            <span class="p">}</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span> <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">1.215</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.012114383184495899</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>VSUN value or a tuple containing the VSUN value and a</dt><dd><p>dictionary of time taken for each step.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float | tuple</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If an unsupported dataset name, distance metric, or screening
    method is provided.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here, I demonstrate how VSUN is computed for binary/continuous distances
with binary/continuous stability. The binary stability score, <span class="math notranslate nohighlight">\(S_b(x)\)</span>
, for each crystal <span class="math notranslate nohighlight">\(x\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_b(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le \text{threshold} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>You can set the threshold in kwargs (see the examples). Default threshold is
0.1 [eV/atom]. The continuous stability score, <span class="math notranslate nohighlight">\(S_c(x)\)</span>, for each
crystal <span class="math notranslate nohighlight">\(x\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_c(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le 0 \\
                1 - \frac{E_\text{hull}(x)}{\text{intercept}} &amp; \text{if }
                E_\text{hull}(x) \le \text{intercept} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>You can set the intercept in kwargs. Default intercept is 1.215
[eV/atom]. Then, the VSUN score with a binary distance is calculated as
follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
        U(x_i) &amp;= I \left( \land_{j=1}^{i-1} \left( V(x_j) = 0 \lor S(x_j)
        = 0 \lor d(x_i, x_j) \neq 0 \right) \right)\\
        N(x_i) &amp;= I \left( \land_{j=1}^{m} d(x_i, y_j) \neq 0 \right)\\
        VSUN &amp;= \frac{1}{n} \sum_{i=1}^{n} V(x_i) \cdot S(x_i) \cdot  U(x_i)
        \cdot N(x_i).
\end{align*}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\{x_1, x_2, \ldots, x_n\}\)</span> is the set of generated crystals,
<span class="math notranslate nohighlight">\(\{y_1, y_2, \ldots, y_m\}\)</span> is the set of training crystals, <span class="math notranslate nohighlight">\(I\)</span>
is the indicator function, <span class="math notranslate nohighlight">\(S\)</span> is either <span class="math notranslate nohighlight">\(S_b\)</span> or <span class="math notranslate nohighlight">\(S_c\)</span>,
and <span class="math notranslate nohighlight">\(V\)</span> is the validity function that returns 1 for valid crystals and
0 for invalid crystals. For a continuous distance, the VSUN score is
calculated as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
        U(x_i) &amp;= \frac{1}{n-1} \sum_{j=1}^{n} V(x_j) \cdot S(x_j)
        \cdot d(x_i, x_j) \\
        N(x_i) &amp;= \min_{j=1 \ldots m} d(x_i, y_j)\\
        VSUN &amp;= \frac{1}{n} \sum_{i=1}^{n} V(x_i) \cdot S(x_i) \cdot  U(x_i)
        \cdot N(x_i).
\end{align*}\end{split}\]</div>
<p>Note that unnormalized continuous distances are always normalized in the
VSUN calculation to ensure that the multiplication of uniqueness and novelty
is valid.</p>
</div>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="xtalmet.distance.html" class="btn btn-neutral float-left" title="xtalmet.distance module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="xtalmet.screen.html" class="btn btn-neutral float-right" title="xtalmet.screen module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Masahiro Negishi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: 0.1.1
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://wmd-group.github.io/xtalmet/index.html">latest</a></dd>
      
        <dd><a href="https://wmd-group.github.io/xtalmet/0.1.0/index.html">0.1.0</a></dd>
      
        <dd><a href="https://wmd-group.github.io/xtalmet/0.1.1/index.html">0.1.1</a></dd>
      
    </dl>
    
    <br>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>