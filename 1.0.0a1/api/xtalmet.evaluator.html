

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>xtalmet.evaluator module &mdash; xtalmet 1.0.0a1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=0745d1ac" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/github_style.css?v=1093691d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=a480e030"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="xtalmet.screen module" href="xtalmet.screen.html" />
    <link rel="prev" title="xtalmet.distance module" href="xtalmet.distance.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            xtalmet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="xtalmet.html">API</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="xtalmet.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="xtalmet.crystal.html">xtalmet.crystal module</a></li>
<li class="toctree-l3"><a class="reference internal" href="xtalmet.distance.html">xtalmet.distance module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">xtalmet.evaluator module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#xtalmet.evaluator.Evaluator"><code class="docutils literal notranslate"><span class="pre">Evaluator</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="xtalmet.screen.html">xtalmet.screen module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">xtalmet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="xtalmet.html">xtalmet package</a></li>
      <li class="breadcrumb-item active">xtalmet.evaluator module</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-xtalmet.evaluator">
<span id="xtalmet-evaluator-module"></span><h1>xtalmet.evaluator module<a class="headerlink" href="#module-xtalmet.evaluator" title="Link to this heading"></a></h1>
<p>This module contains the Evaluator class for VSUN calculation.</p>
<dl class="py class">
<dt class="sig sig-object py" id="xtalmet.evaluator.Evaluator">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">xtalmet.evaluator.</span></span><span class="sig-name descname"><span class="pre">Evaluator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">validity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stability</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'continuous'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'binary'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uniqueness</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">novelty</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_xtals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><span class="pre">Crystal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Structure</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agg_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'prod'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'ave'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'prod'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiprocessing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_processes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xtalmet.evaluator.Evaluator" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class for evaluating a set of crystals.</p>
<p>The evaluation is based on a chosen combination of validity (V), stability (S),
uniqueness (U), and novelty (N).</p>
<p>Initialize the Evaluator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>validity</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>) – Approaches to evaluating validity.
The currently supported methods are shown in SUPPORTED_VALIDITY in
constants.py. If set to None, validity is not evaluated. Default is
None.</p></li>
<li><p><strong>stability</strong> (<em>Literal</em><em>[</em><em>&quot;continuous&quot;</em><em>, </em><em>&quot;binary&quot;</em><em>, </em><em>None</em><em>]</em>) – Stability evaluation
method. “continuous” or “binary” or None. If set to None, stability is
not evaluated. Default is None.</p></li>
<li><p><strong>uniqueness</strong> (<em>bool</em>) – Whether to evaluate uniqueness. Default is False.</p></li>
<li><p><strong>novelty</strong> (<em>bool</em>) – Whether to evaluate novelty. Default is False.</p></li>
<li><p><strong>distance</strong> (<em>str</em><em> | </em><em>None</em>) – Distance metric used for uniqueness and novelty
evaluation. The currently supported distances are listed in
SUPPORTED_DISTANCES in constants.py. For more detailed information about
each distance metric, please refer to the <a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>. If both
uniqueness and novelty are False, this argument is ignored. Default is
None.</p></li>
<li><p><strong>ref_xtals</strong> (<em>list</em><em>[</em><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><em>Crystal</em></a><em>  |  </em><em>Structure</em><em>]  </em><em>|  </em><em>str</em><em>  |  </em><em>None</em>) – Reference crystal
structures (typically a training set) for novelty evaluation. This can
be a list of crystal structures, dataset name, or a path to the file
containing the pre-computed embeddings of the reference structures. If a
dataset name is given, its training data will be downloaded from Hugging
Face. If novelty is False, this argument is ignored. Default is None.</p></li>
<li><p><strong>agg_func</strong> (<em>Literal</em><em>[</em><em>&quot;prod&quot;</em><em>, </em><em>&quot;ave&quot;</em><em>]</em>) – Aggregation function for combining V, S,
U, and N. “prod” means multiplication, and “ave” means (weighted)
average. Default is “prod”.</p></li>
<li><p><strong>weights</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>float</em><em>] </em><em>| </em><em>None</em>) – Weights for V, S, U, and N when agg_func
is “ave”. For example, {“validity”: 0.2, “stability”: 0.3, “uniqueness”:
0.2, “novelty”: 0.3}. You only need to provide weights for the metrics
you choose to evaluate. If the weights are not normalized, they will be
normalized internally. If None, equal weights are used. Default is None.</p></li>
<li><p><strong>multiprocessing</strong> (<em>bool</em>) – Whether to use multiprocessing for computing the
embeddings of reference crystals. This argument is only effective when
novelty is True and ref_xtals is list[Crystal | Structure]. Default
is False.</p></li>
<li><p><strong>n_processes</strong> (<em>int</em><em> | </em><em>None</em>) – Maximum number of processes to use for
multiprocessing. If None, the number of logical CPU cores - 1 will be
used. We recommend setting this argument to a smaller number than the
number of available CPU cores to avoid out-of-memory. If multiprocessing
is False, this argument is ignored. Default is None.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments. It can contain four keys:
“args_validiity”, “args_stability”, “args_emb”, and “args_dist”.
“args_validity” is for the validity evaluation, while “args_stability”
is for the stability evaluation. “args_emb” and “args_dist” are for the
distance metric used in uniqueness and novelty evaluation: The former
is for the embedding calculation, and the latter is for the distance
matrix calculation between embeddings. For more details, please refer to
the <a class="reference external" href="https://github.com/WMD-group/xtalmet/blob/main/examples/tutorial.ipynb">tutorial notebook</a>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Evaluator for the conventional SUN metric against the MP20 dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># using the StructureMatcher distance.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">uniqueness</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">novelty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;smat&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">ref_xtals</span><span class="o">=</span><span class="s2">&quot;mp20&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;prod&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Evaluator for the VSUN metric against a custom reference dataset using</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the ElMD distance, with average aggregation.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">uniqueness</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">novelty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;elmd&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">ref_xtals</span><span class="o">=</span><span class="n">ref_xtals</span><span class="p">,</span>  <span class="c1"># list[Crystal | Structure]</span>
<span class="gp">... </span>    <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;ave&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">weights</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;validity&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;stability&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;uniqueness&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;novelty&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Evaluator for the VSUN metric against the MP20 dataset using the AMD</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># distance, with custom kwargs.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">uniqueness</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">novelty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;amd&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">ref_xtals</span><span class="o">=</span><span class="s2">&quot;mp20&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;prod&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_validity&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_distance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_volume&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="gp">... </span>            <span class="p">}</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;mace_model&quot;</span><span class="p">:</span> <span class="s2">&quot;mace-mh-1&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">1.215</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_emb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_dist&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;chebyshev&quot;</span><span class="p">,</span> <span class="s2">&quot;low_memory&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="xtalmet.evaluator.Evaluator.evaluate">
<span class="sig-name descname"><span class="pre">evaluate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xtals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><span class="pre">Crystal</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Structure</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_intermediate</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multiprocessing</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_processes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#xtalmet.evaluator.Evaluator.evaluate" title="Link to this definition"></a></dt>
<dd><p>Evaluate the given crystal structures.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xtals</strong> (<em>list</em><em>[</em><a class="reference internal" href="xtalmet.crystal.html#xtalmet.crystal.Crystal" title="xtalmet.crystal.Crystal"><em>Crystal</em></a><em>  |  </em><em>Structure</em><em>]</em>) – List of crystal structures to be
evaluated.</p></li>
<li><p><strong>dir_intermediate</strong> (<em>str</em><em> | </em><em>None</em>) – Directory to search for pre-computed
intermediate results, such as validity scores, energy above hulls,
embeddings, and distance matrices. If pre-computed files do not exist in
the directory, they will be computed and saved to the directory for
future use. If set to None, no files will be loaded or saved. It is
recommended to set this argument when evaluating the same large set of
crystal structures multiple times, for example trying different
aggregation functions. The intermediate results can be shared as long as
the same set of crystals is evaluated. Default is None.</p></li>
<li><p><strong>multiprocessing</strong> (<em>bool</em>) – Whether to use multiprocessing for embedding and
distance matrix computation. This argument is only effective when
uniqueness or novelty evaluation is enabled. Default is False.</p></li>
<li><p><strong>n_processes</strong> (<em>int</em><em> | </em><em>None</em>) – Maximum number of processes to use for
multiprocessing. If None, the number of logical CPU cores - 1 will be
used. We recommend setting this argument to a smaller number than the
number of available CPU cores to avoid out-of-memory. If multiprocessing
is False, this argument is ignored. Default is None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the overall
score (float), individual scores for each crystal structure, and a
dictionary of computation times for each evaluation component.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[float, np.ndarray, dict[str, float]]</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Evaluate the conventional SUN metric using the StructureMatcher</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># distance (&quot;smat&quot;) against the MP20 dataset.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">uniqueness</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">novelty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;smat&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">ref_xtals</span><span class="o">=</span><span class="s2">&quot;mp20&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;prod&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">xtals</span><span class="o">=</span><span class="n">xtals</span><span class="p">,</span>  <span class="c1"># list[Crystal | Structure]</span>
<span class="gp">... </span>    <span class="n">dir_intermediate</span><span class="o">=</span><span class="s2">&quot;intermediate_results/&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.0316</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">]),</span> <span class="p">{</span><span class="s2">&quot;aggregation&quot;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Evaluate the VSUN metric using the ElMD distance against a custom</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># reference dataset, with average aggregation.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">uniqueness</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">novelty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;elmd&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">ref_xtals</span><span class="o">=</span><span class="n">ref_xtals</span><span class="p">,</span>  <span class="c1"># list[Crystal | Structure]</span>
<span class="gp">... </span>    <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;ave&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">weights</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;validity&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;stability&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;uniqueness&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;novelty&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">xtals</span><span class="o">=</span><span class="n">xtals</span><span class="p">,</span>  <span class="c1"># list[Crystal | Structure]</span>
<span class="gp">... </span>    <span class="n">dir_intermediate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.017467859079216795</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">]),</span> <span class="p">{</span><span class="s2">&quot;aggregation&quot;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Evaluate the VSUN metric using the AMD distance against the MP20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># dataset, with custom kwargs.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">validity</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;smact&quot;</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">stability</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">uniqueness</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">novelty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">distance</span><span class="o">=</span><span class="s2">&quot;amd&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">ref_xtals</span><span class="o">=</span><span class="s2">&quot;mp20&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;prod&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;args_validity&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_distance&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                <span class="s2">&quot;threshold_volume&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="gp">... </span>            <span class="p">}</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_stability&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;diagram&quot;</span><span class="p">:</span> <span class="s2">&quot;mp_250618&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;mace_model&quot;</span><span class="p">:</span> <span class="s2">&quot;mace-mh-1&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">1.215</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_emb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
<span class="gp">... </span>        <span class="s2">&quot;args_dist&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="s2">&quot;chebyshev&quot;</span><span class="p">,</span> <span class="s2">&quot;low_memory&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">xtals</span><span class="o">=</span><span class="n">xtals</span><span class="p">,</span>  <span class="c1"># list[Crystal | Structure]</span>
<span class="gp">... </span>    <span class="n">dir_intermediate</span><span class="o">=</span><span class="s2">&quot;intermediate_results/&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">n_processes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0.0268044218595296</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">]),</span> <span class="p">{</span><span class="s2">&quot;aggregation&quot;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here, I demonstrate how VSUN (or its subsets) is computed. Validity
<span class="math notranslate nohighlight">\(V(x)\)</span> of each crystal <span class="math notranslate nohighlight">\(x\)</span> is 0 (invalid) or 1 (valid) depending
on whether it passes the specified validity checks. If you specify multiple
validity methods <span class="math notranslate nohighlight">\(V_1(x)\)</span>, <span class="math notranslate nohighlight">\(V_2(x)\)</span>, …, the overall validity
is the product of individual validity scores:</p>
<div class="math notranslate nohighlight">
\[V(x) = \prod_i V_i(x)\]</div>
<p>Stability <span class="math notranslate nohighlight">\(S(x)\)</span> is computed from the energy above hull, and has two
variants: binary and continuous. The binary stability score <span class="math notranslate nohighlight">\(S_b(x)\)</span>
is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_b(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le \text{threshold} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>“threshold” can be specified in kwargs when initializing the Evaluator. The
default value is 0.1 [eV/atom]. The continuous stability score
<span class="math notranslate nohighlight">\(S_c(x)\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}S_c(x) =
        \begin{cases}
                1 &amp; \text{if } E_\text{hull}(x) \le 0 \\
                1 - \frac{E_\text{hull}(x)}{\text{intercept}} &amp; \text{if }
                0 \le E_\text{hull}(x) \le \text{intercept} \\
                0 &amp; \text{otherwise}
        \end{cases}\end{split}\]</div>
<p>“intercept” can be specified in kwargs when initializing the Evaluator. The
default value is 1.215 [eV/atom]. In both cases, a higher score closer to 1
indicates a more stable structure. The definition of uniqueness <span class="math notranslate nohighlight">\(U(x)\)</span>
depends on the chosen distance metric. For a binary distance <span class="math notranslate nohighlight">\(d_b\)</span>,
uniqueness of the i-th crystal <span class="math notranslate nohighlight">\(x_i\)</span> in the set of crystals
<span class="math notranslate nohighlight">\(\{x_1, x_2, \ldots, x_n\}\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[U_b(x_i) = I \left(\land_{j=1}^{i-1} d_b(x_i, x_j) \neq 0 \right),\]</div>
<p>where <span class="math notranslate nohighlight">\(I\)</span> is the indicator function. For a continuous distance
<span class="math notranslate nohighlight">\(d_c\)</span>, uniqueness is defined as follows.</p>
<div class="math notranslate nohighlight">
\[U_c(x_i) = \frac{1}{n-1} \sum_{j=1}^{n} d_c(x_i, x_j).\]</div>
<p>In both cases, the score ranges from 0 to 1, since the binary distance takes
values of 0 or 1, and the continuous distance is normalized to be between 0
and 1. A higher score indicates a more unique structure. Novelty
<span class="math notranslate nohighlight">\(N(x)\)</span> is defined similarly to uniqueness, but against a reference set
of crystals. For a binary distance <span class="math notranslate nohighlight">\(d_b\)</span>, novelty of the i-th crystal
<span class="math notranslate nohighlight">\(x_i\)</span> is defined as follows.</p>
<div class="math notranslate nohighlight">
\[N_b(x_i) = I \left(\land_{j=1}^{m} d_b(x_i, y_j) \neq 0 \right),\]</div>
<p>where <span class="math notranslate nohighlight">\(\{y_1, y_2, \ldots, y_m\}\)</span> is the reference set of crystals.
For a continuous distance <span class="math notranslate nohighlight">\(d_c\)</span>, novelty is defined as follows.</p>
<div class="math notranslate nohighlight">
\[N_c(x_i) = \min_{j=1 \ldots m} d_c(x_i, y_j).\]</div>
<p>In both cases, the socre ranges from 0 to 1, and a higher score indicates a
more novel structure. Finally, the VSUN score of each crystal <span class="math notranslate nohighlight">\(x\)</span> is
computed by aggregating the individual scores using either multiplication or
(weighted) average:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\text{VSUN}(x) =
        \begin{cases}
                V(x) S(x) U(x) N(x) &amp;
                \text{if agg_func = “prod&quot;} \\
                w_V V(x) + w_S S(x) + w_U U(x) + w_N N(x) &amp;
                \text{if agg_func =“ave&quot;}
        \end{cases}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(w_V\)</span>, <span class="math notranslate nohighlight">\(w_S\)</span>, <span class="math notranslate nohighlight">\(w_U\)</span>, and <span class="math notranslate nohighlight">\(w_N\)</span> are the
normalized weights for validity, stability, uniqueness, and novelty,
respectively. If only a subset of VSUN is evaluated, each crystal’s score is
computed using only the specified components in the similar manner. The
overall single score for the entire set of crystals is then obtained by
averaging the individual scores.</p>
<div class="math notranslate nohighlight">
\[\text{VSUN} = \frac{1}{n} \sum_{i=1}^{n} \text{VSUN}(x_i)\]</div>
</div>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="xtalmet.distance.html" class="btn btn-neutral float-left" title="xtalmet.distance module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="xtalmet.screen.html" class="btn btn-neutral float-right" title="xtalmet.screen module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Masahiro Negishi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    Version: 1.0.0a1
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://wmd-group.github.io/xtalmet/index.html">latest</a></dd>
      
        <dd><a href="https://wmd-group.github.io/xtalmet/0.1.0/index.html">0.1.0</a></dd>
      
        <dd><a href="https://wmd-group.github.io/xtalmet/0.1.1/index.html">0.1.1</a></dd>
      
        <dd><a href="https://wmd-group.github.io/xtalmet/1.0.0a1/index.html">1.0.0a1</a></dd>
      
    </dl>
    
    <br>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>